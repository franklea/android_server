<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link type="text/css" rel="stylesheet" href="/css/webbackcss.css"/>
<link rel="stylesheet" href="/js/kindeditor/themes/default/default.css" />
<link rel="stylesheet" href="/css/uploadify.css" />
<title>服务编辑</title>
</head>
<body>
<div class="main">
    <!--header-->
	#parse("backheader.vm")
    <!--左边框-->
    <div class="left_frame">
        <ul class="left_ul">
            <li class="left_title"><a href="/serviceback/serviceshow/1">服务信息管理</a></li>
            <li class="left_li_active"><div><a href="/serviceback/serviceshow/1">服务信息管理</a><span></span><div style="clear:both;"></div></div></li>
            <li class="left_li"><div><a href="/serviceback/typeshow">服务分类管理</a><span></span><div style="clear:both;"></div></div></li>
            <li class="left_li"><div><a href="/serviceback/picture">服务图片管理</a><span></span><div style="clear:both;"></div></div></li>
        </ul>
        <div style="clear:both"></div>
    </div>
    
    
    <!--右边框-->
    <div class="right_frame" style="height:1200px;">
        <div class="bigright_box" >
           <form id="kindEditor_From" 
           		#if(${data.containsKey("id")})
           			action="/serviceback/updateservice"
           		#else
           			action="/serviceback/insertservice"
           		#end
          	 style="margin:0;padding:0" method="post"> 
          	 <input style="display:none" name="id" #if(${data.containsKey("id")}) value="${data.get("id")}" #else value=0 #end>
               <span class="filter_itemname" >服务名称:</span>
               <input name="name" class="filter_input" style="width:200px;"  #if(${data.containsKey("id")}) value="${data.get("name")}" #end/>
               <a id="kindEditor" class="single_btn">保存</a>
				<div style="clear:both;height:5px;"></div>
				
				<!--选择分类-->
               <div class="class_selectbox" style="margin-bottom:0;">
                   <div class="class_select">
                        <span class="filter_itemname" style="text-align:left;">服务分类:</span>
                        <select class="filter_input" id="serviceType">
		                
			                #foreach($typeService in ${data.get("typeName")})
			                	<option value="${typeService.get("id")}" #if(${data.containsKey("id")} &&${data.get("type")} == ${typeService.get("id")}) selected #end>${typeService.get("name")}</option>
			                #end
			                
		                </select>
                        <input name="type" style="display:none" #if(${data.containsKey("id")})   value="${data.get("type")}" #end>
                   </div>
               </div>
             
              <div style="clear:both;"></div>
               <span class="filter_itemname">置顶图片:</span>
               <input name="pic" id="toppic"  class="filter_input" style="width:200px;" #if(${data.containsKey("id")}) value="${data.get("pic")}" #end/>
               <input id="toppicbtn" type="file" class="select_pic_btn" />
               
               <div style="clear:both;height:5px;"></div>
               <span class="filter_itemname" >服务摘要:</span>
               <textarea name="info"  rows="5" cols="50" style="float:left;" >#if(${data.containsKey("id")})${data.get("info")}#end</textarea>
               
               <div style="clear:both;height:10px;"></div>
               <span class="filter_itemname">显示内容:</span>
               <input class="showExplain" style="float:right" type="button" value="添加名词解释">
               <div>
                   <textarea name="content" id="editor_id" rows="30" cols="60" style="float:left;margin-left:0;display: block;" >#if(${data.containsKey("id")})${data.get("content")}#end</textarea>
                   <div style="clear:both;"></div>
               </div>
               <div style="clear:both;"></div>
            </form>
        </div>
        <div style="clear:both"></div>
    </div>
    <div style="clear:both"></div>
</div>
#include("explaindiv.vm")
<script type="text/javascript" src="/js/jquery-2.0.2.js"></script>
<script type="text/javascript" src="/js/webbackjs.js"></script>  
<script charset="utf-8" src="/js/kindeditor/kindeditor-min.js"></script>
<script charset="utf-8" src="/js/kindeditor/lang/zh_CN.js"></script>
<script type="text/javascript" src="/js/jquery.uploadify.min.js"></script>
<script>
 var editor;  
 $(document).ready(function(){
    nav_active=4;
    change2active($(".nav_li").eq(nav_active));   
    #include("explainJS.vm")
    if($("input[name='type']").val()=="")
    {
        $("input[name='type']").val($("#serviceType").val());
    }
    var options = {  
       themeType : 'default',   //指定主题风格，可设置”default”、”simple”，指定simple时需要引入simple.css; 默认值: “default”  
       resizeType: 0,           //2或1或0，2时可以拖动改变宽度和高度，1时只能改变高度，0时不能拖动;默认值: 2  
       allowFileManager:true,   //true时显示浏览远程服务器按钮 ;默认值: false  
       allowMediaUpload:false, //true时显示视音频上传按钮。默认值: true  
       allowFlashUpload:false, //true时显示Flash上传按钮;默认值: true  
       uploadJson:'/upload',          //指定上传文件的服务器端程序  
       fileManagerJson:'/download',     //指定浏览远程图片的服务器端程序  
       afterCreate:function(){ //加载完成后改变皮肤  
           var color = $('.panel-header').css('background-color');  
           $('.ke-toolbar').css('background-color',color);  
       }  
       //afterBlur: function(){this.sync();}
         
   };  
   editor = KindEditor.create('#editor_id',options);  
   
    $('#kindEditor').click(function(){  
        var f = $('#kindEditor_From');
        editor.sync();
        if(checkForm())
            f.submit();  
    }); 
    $(".ke-container").css({"width":"710px","margin-left":"20px","height":"610px"});
    $(".ke-edit").css({"height":"548px"});
    $(".ke-edit-iframe").css({"height":"548px"});
    
   var options_upload={
        'auto'          : true,
        'swf'           : '/js/uploadify.swf',
        'uploader'      : '/upload',
        'buttonText'    : '选择文件',
        'height'        : 20,
        'width'         : 80
    }

    $("#toppicbtn").uploadify(options_upload);
    $("#toppicbtn").uploadify('settings','onUploadSuccess',function(file, data, response) {  
                                var d=eval("("+data+")");
                                if(d.error==1)  alert(d.message);
                                else  $("#toppic").val(d.url);
                            });
    $("#attachbtn").uploadify(options_upload);
    $("#attachbtn").uploadify('settings','onUploadSuccess',function(file, data, response) {  
                                var d=eval("("+data+")");
                                if(d.error==1)  alert(d.message);
                                else  $("#attach").val(d.url);
                            });
    


    $("#serviceType").change(function(){
        //alert($("#solution input[type='checkbox']:checked").parent().attr("name"));
        $("input[name='type']").val($(this).val());
    });
    
});
function fileManage() {  
    editor.loadPlugin('filemanager', function() {  
        editor.plugin.filemanagerDialog({  
            viewType : 'VIEW',  
            dirName : 'image',  
            clickFn : function(url, title) {  
                editor.insertHtml('<img src="'+url+'" alt="" />');  
                editor.hideDialog();  
            }  
        });  
    });  
}  
</script>
</body>
</html>