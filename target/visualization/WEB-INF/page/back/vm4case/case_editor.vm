<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link type="text/css" rel="stylesheet" href="/css/webbackcss.css"/>
<link rel="stylesheet" href="/js/kindeditor/themes/default/default.css" />
<link rel="stylesheet" href="/css/uploadify.css" />
<title>成功案例编辑</title>
</head>
<body>
<div class="main">
    <!--header-->
	#parse("backheader.vm")
    <!--左边框-->
    <div class="left_frame">
        <ul class="left_ul">
            <li class="left_title"><a href="/caseback/show/1">案例管理</a></li>
            <li class="left_li_active"><div><a href="/caseback/show/1">案例信息管理</a><span></span><div style="clear:both;"></div></div></li>
        </ul>
        <div style="clear:both"></div>
    </div>
    
    
    <!--右边框-->
    <div class="right_frame" style="height:1200px;">
        <div class="bigright_box" >
           <form id="kindEditor_From" 
           		#if(${data.containsKey("id")})
           			action="/caseback/update"
           		#else
           			action="/caseback/insert"
           		#end
           style="margin:0;padding:0" method="post"> 
           <input style="display:none" name="id" #if(${data.containsKey("id")}) value="${data.get("id")}" #else value=0 #end>
               <span class="filter_itemname" >案例名称:</span>
               <input name="name" class="filter_input" style="width:200px;" value="#if(${data.containsKey("name")})${data.get("name")}#end"/>
               <a id="kindEditor" class="single_btn">保存</a>
				<div style="clear:both;height:5px;"></div>
               
               <span class="filter_itemname" >首页显示:</span>
               <input name="shown" style="width:20px;" type="checkbox" class="filter_input" #if(${data.containsKey("shown")} && ${data.get("shown")}==1) checked #end/>
               
               <div style="clear:both;height:5px;"></div>
               <span class="filter_itemname">首页图片:</span>
               <input name="face" id="homepic" class="filter_input" style="width:200px;" value="#if(${data.containsKey("face")})${data.get("face")}#end"/>
               <input id="homepicbtn" type="file" class="select_face_btn" />
               
               <div style="clear:both;height:5px;"></div>
               <span class="filter_itemname">附件:</span>
               <input name="download" id="attach" class="filter_input" style="width:200px;" value="#if(${data.containsKey("download")})${data.get("download")}#end"/>
               <input id="attachbtn" type="file" class="select_file_btn"/>
               
               <div style="clear:both;height:10px;"></div>
               <span class="filter_itemname" >案例摘要:</span>
               <textarea name="info"  rows="5" cols="50" style="float:left;" >#if(${data.containsKey("info")})${data.get("info")}#end</textarea>
               <div style="clear:both;height:10px;"></div>
               <div class="class_selectbox">
                   <div class="class_select">
                        <span class="filter_itemname" style="width:150px;text-align:left;">选择关联的解决方案:</span>
                        <ul id="solution" class="class_ul" >
                        
                        	#foreach($solution in ${data.get("choice").get("solution")})
                        		<li name="${solution.get("id")}" class="class_li"><input type="checkbox" #if(${data.containsKey("id")} &&${data.get("solution")} == ${solution.get("id")}) checked #end/><span>${solution.get("name")}</span></li>
                        	#end
                        	
                            
                        </ul>
                        <input name="solution" style="display:none" #if(${data.containsKey("solution")})   value="${data.get("solution")}" #else value=0 #end>
                   </div>
                    <div class="class_select">
                        <span class="filter_itemname" style="width:150px;text-align:left;">选择关联的产品:</span>
                        <ul id="product" class="class_ul" >
                        
                            #foreach($solution in ${data.get("choice").get("product")})
                        		<li name="${solution.get("id")}" class="class_li"><input type="checkbox" #if(${data.containsKey("id")} &&${data.get("product")} == ${solution.get("id")}) checked #end/><span>${solution.get("name")}</span></li>
                        	#end
                        	
                        </ul>
                        <input name="product" style="display:none" #if(${data.containsKey("product")})   value="${data.get("product")}"  #else value=0 #end>
                   </div>
                   <div class="class_select">
                        <span class="filter_itemname" style="width:150px;text-align:left;">选择关联的服务:</span>
                        <ul id="service" class="class_ul" >
                            
							#foreach($solution in ${data.get("choice").get("service")})
                        		<li name="${solution.get("id")}" class="class_li"><input type="checkbox" #if(${data.containsKey("id")} &&${data.get("service")} == ${solution.get("id")}) checked #end/><span>${solution.get("name")}</span></li>
                        	#end
							
                        </ul>
                        <input name="service" style="display:none" #if(${data.containsKey("service")})   value="${data.get("service")}" #else value=0  #end>
                   </div>
               
               </div>
               <div style="clear:both;height:10px;"></div>
               <span class="filter_itemname">显示内容:</span>
               <input class="showExplain" style="float:right" type="button" value="添加名词解释">
               <div>
                   <textarea name="content" id="editor_id" rows="30" cols="60" style="float:left;margin-left:0;display: block;" >#if(${data.containsKey("content")})${data.get("content")}#end</textarea>
                   <div style="clear:both;"></div>
               </div>
               <div style="clear:both;"></div>
            </form>
        </div>
        <div style="clear:both"></div>
    </div>
    <div style="clear:both"></div>
</div>
#include("explaindiv.vm")
<script type="text/javascript" src="/js/jquery-2.0.2.js"></script>
<script type="text/javascript" src="/js/webbackjs.js"></script>  
<script charset="utf-8" src="/js/kindeditor/kindeditor-min.js"></script>
<script charset="utf-8" src="/js/kindeditor/lang/zh_CN.js"></script>
<script type="text/javascript" src="/js/jquery.uploadify.min.js"></script>
<script>
 var editor;  
 $(document).ready(function(){
    nav_active=5;
    change2active($(".nav_li").eq(nav_active));      
    #parse("explainJS.vm")
    var options = {  
       themeType : 'default',   //指定主题风格，可设置”default”、”simple”，指定simple时需要引入simple.css; 默认值: “default”  
       resizeType: 0,           //2或1或0，2时可以拖动改变宽度和高度，1时只能改变高度，0时不能拖动;默认值: 2  
       allowFileManager:true,   //true时显示浏览远程服务器按钮 ;默认值: false  
       allowMediaUpload:false, //true时显示视音频上传按钮。默认值: true  
       allowFlashUpload:false, //true时显示Flash上传按钮;默认值: true  
       uploadJson:'/upload',          //指定上传文件的服务器端程序  
       fileManagerJson:'/download',     //指定浏览远程图片的服务器端程序  
       afterCreate:function(){ //加载完成后改变皮肤  
           var color = $('.panel-header').css('background-color');  
           $('.ke-toolbar').css('background-color',color);  
       }  
       //afterBlur: function(){this.sync();}
         
   };  
   editor = KindEditor.create('#editor_id',options);  
   
    $('#kindEditor').click(function(){  
        var f = $('#kindEditor_From');
        editor.sync();
        if(checkForm())
            f.submit();  
    }); 
    $(".ke-container").css({"width":"710px","margin-left":"20px","height":"610px"});
    $(".ke-edit").css({"height":"548px"});
    $(".ke-edit-iframe").css({"height":"548px"});
    
    var options_upload={
        'auto'          : true,
        'swf'           : '/js/uploadify.swf',
        'uploader'      : '/upload',
        'buttonText'    : '选择文件',
        'height'        : 20,
        'width'         : 80,
        'onUploadSuccess' : function(file, data, response) {  
                                var d=eval("("+data+")");
                                if(d.error==1)
                                    alert(d.message);
                                else
                                {
                                    var idstr=$(this).attr("id");
                                    alert(d.url+idstr);
                                } 
                            }
    }
    $("#homepicbtn").uploadify(options_upload);
    $("#homepicbtn").uploadify('settings','onUploadSuccess',function(file, data, response) {  
                                var d=eval("("+data+")");
                                if(d.error==1)  alert(d.message);
                                else  $("#homepic").val(d.url);
                            });
    $("#attachbtn").uploadify(options_upload);
    $("#attachbtn").uploadify('settings','onUploadSuccess',function(file, data, response) {  
                                var d=eval("("+data+")");
                                if(d.error==1)  alert(d.message);
                                else  $("#attach").val(d.url);
                            });
    $("input[type='checkbox']").click(function(){
        $(this).parent().siblings().find("input[type='checkbox']").prop("checked",false);
        //alert($("#solution input[type='checkbox']:checked").parent().attr("name"));
        if($("#solution input[type='checkbox']:checked").length>0)
            $("input[name='solution']").val($("#solution input[type='checkbox']:checked").parent().attr("name"));
        else
            $("input[name='solution']").val("0");
        if($("#product input[type='checkbox']:checked").length>0)
            $("input[name='product']").val($("#product input[type='checkbox']:checked").parent().attr("name"));
        else
            $("input[name='product']").val("0");
        if($("#service input[type='checkbox']:checked").length>0)
            $("input[name='service']").val($("#service input[type='checkbox']:checked").parent().attr("name"));
        else
            $("input[name='service']").val("0");
    });
    
});
function fileManage() {  
    editor.loadPlugin('filemanager', function() {  
        editor.plugin.filemanagerDialog({  
            viewType : 'VIEW',  
            dirName : 'image',  
            clickFn : function(url, title) {  
                editor.insertHtml('<img src="'+url+'" alt="" />');  
                editor.hideDialog();  
            }  
        });  
    });  
}  
</script>
</body>
</html>